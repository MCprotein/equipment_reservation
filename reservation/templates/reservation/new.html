{% extends 'base.html' %}
{% load static %}
{% block script %}
    <script type="text/javascript" src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <link type="text/css" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.min.css" rel="stylesheet">
    <link rel=icon href="{% static 'reservation/tmdlogo.png' %}" sizes="32x16" type="image/png">
    <link rel="stylesheet" href="{% static 'reservation/main.css' %}">
{% endblock %}

{% block content %}
    <main style="height: 125vh;">
        <section id="reserve">
            <!-- <h3>예약 하기</h3> -->
            <div class="buttons">
                <button id="Hood" onclick="goNewHood()">후드</button>
                <button id="Chiller" onclick="goNewChiller()">칠러</button>
                <button id="Press" onclick="goNewPress()">핫프레스</button>
                <button id="Dsc" onclick="goNewDsc()">DSC</button>
                <button id="Gpc" onclick="goNewGpc()">GPC</button>
                <button id="Utm" onclick="goNewUtm()">UTM</button>
                <button id="Crosslinker" onclick="goNewCrosslinker()">가교기</button>
            </div>
            <div class="selects">
                <form action="{% url 'reservation:create' %}" id="new_form">
                    <input name="user" value="{{user.username}}" type="hidden"/>
                    <p>장비:
                        <input readonly name="equipment_type" value="{{equipment_type}}" type="text" id="equipment_type" style="width:100px;height:30px;">
                    </p>
                    <p>예약 날짜:
                        <input name="equipment_date" type="text" id="datepicker" style="width:100px;height:30px;">
                    </p>
                    <p>시작 시간:
                        <select name="equip_start_time" id="equip_start_time" onchange="finishSet()">
                            <option value="선택">선택</option>
                            <option value="9">09:00</option>
                            <option value="9.5">09:30</option>
                            <option value="10">10:00</option>
                            <option value="10.5">10:30</option>
                            <option value="11">11:00</option>
                            <option value="11.5">11:30</option>
                            <option value="12">12:00</option>
                            <option value="12.5">12:30</option>
                            <option value="13">13:00</option>
                            <option value="13.5">13:30</option>
                            <option value="14">14:00</option>
                            <option value="14.5">14:30</option>
                            <option value="15">15:00</option>
                            <option value="15.5">15:30</option>
                            <option value="16">16:00</option>
                            <option value="16.5">16:30</option>
                            <option value="17">17:00</option>
                            <option value="17.5">17:30</option>
                            <option value="18">18:00</option>
                        </select>
                    </p>
                    <p>종료 시간:
                        <select name="equip_finish_time" id="equip_finish_time">
                        </select>
                        <button type="button" class="btn_return" id="equip_check">예약</button>
                    </form>
                </p>
            </div>
        </section>
        <section id="reserve_all">
            <h3>예약 현황</h3>
            <table>
                <tr>
                    <th></th>
                    <th id="Mon">월</th>
                    <th id="Tue">화</th>
                    <th id="Wed">수</th>
                    <th id="Thur">목</th>
                    <th id="Fri">금</th>
                </tr>
                <tr>
                    <td>09:00</td>
                    <td id="Mon_9"></td>
                    <td id="Tue_9"></td>
                    <td id="Wed_9"></td>
                    <td id="Thur_9"></td>
                    <td id="Fri_9"></td>
                </tr>
                <tr>
                    <td>09:30</td>
                    <td id="Mon_9.5"></td>
                    <td id="Tue_9.5"></td>
                    <td id="Wed_9.5"></td>
                    <td id="Thur_9.5"></td>
                    <td id="Fri_9.5"></td>
                </tr>
                <tr>
                    <td>10:00</td>
                    <td id="Mon_10"></td>
                    <td id="Tue_10"></td>
                    <td id="Wed_10"></td>
                    <td id="Thur_10"></td>
                    <td id="Fri_10"></td>
                </tr>
                <tr>
                    <td>10:30</td>
                    <td id="Mon_10.5"></td>
                    <td id="Tue_10.5"></td>
                    <td id="Wed_10.5"></td>
                    <td id="Thur_10.5"></td>
                    <td id="Fri_10.5"></td>
                </tr>
                <tr>
                    <td>11:00</td>
                    <td id="Mon_11"></td>
                    <td id="Tue_11"></td>
                    <td id="Wed_11"></td>
                    <td id="Thur_11"></td>
                    <td id="Fri_11"></td>
                </tr>
                <tr>
                    <td>11:30</td>
                    <td id="Mon_11.5"></td>
                    <td id="Tue_11.5"></td>
                    <td id="Wed_11.5"></td>
                    <td id="Thur_11.5"></td>
                    <td id="Fri_11.5"></td>
                </tr>
                <tr>
                    <td>12:00</td>
                    <td id="Mon_12"></td>
                    <td id="Tue_12"></td>
                    <td id="Wed_12"></td>
                    <td id="Thur_12"></td>
                    <td id="Fri_12"></td>
                </tr>
                <tr>
                    <td>12:30</td>
                    <td id="Mon_12.5"></td>
                    <td id="Tue_12.5"></td>
                    <td id="Wed_12.5"></td>
                    <td id="Thur_12.5"></td>
                    <td id="Fri_12.5"></td>
                </tr>
                <tr>
                    <td>13:00</td>
                    <td id="Mon_13"></td>
                    <td id="Tue_13"></td>
                    <td id="Wed_13"></td>
                    <td id="Thur_13"></td>
                    <td id="Fri_13"></td>
                </tr>
                <tr>
                    <td>13:30</td>
                    <td id="Mon_13.5"></td>
                    <td id="Tue_13.5"></td>
                    <td id="Wed_13.5"></td>
                    <td id="Thur_13.5"></td>
                    <td id="Fri_13.5"></td>
                </tr>
                <tr>
                    <td>14:00</td>
                    <td id="Mon_14"></td>
                    <td id="Tue_14"></td>
                    <td id="Wed_14"></td>
                    <td id="Thur_14"></td>
                    <td id="Fri_14"></td>
                </tr>
                <tr>
                    <td>14:30</td>
                    <td id="Mon_14.5"></td>
                    <td id="Tue_14.5"></td>
                    <td id="Wed_14.5"></td>
                    <td id="Thur_14.5"></td>
                    <td id="Fri_14.5"></td>
                </tr>
                <tr>
                    <td>15:00</td>
                    <td id="Mon_15"></td>
                    <td id="Tue_15"></td>
                    <td id="Wed_15"></td>
                    <td id="Thur_15"></td>
                    <td id="Fri_15"></td>
                </tr>
                <tr>
                    <td>15:30</td>
                    <td id="Mon_15.5"></td>
                    <td id="Tue_15.5"></td>
                    <td id="Wed_15.5"></td>
                    <td id="Thur_15.5"></td>
                    <td id="Fri_15.5"></td>
                </tr>
                <tr>
                    <td>16:00</td>
                    <td id="Mon_16"></td>
                    <td id="Tue_16"></td>
                    <td id="Wed_16"></td>
                    <td id="Thur_16"></td>
                    <td id="Fri_16"></td>
                </tr>
                <tr>
                    <td>16:30</td>
                    <td id="Mon_16.5"></td>
                    <td id="Tue_16.5"></td>
                    <td id="Wed_16.5"></td>
                    <td id="Thur_16.5"></td>
                    <td id="Fri_16.5"></td>
                </tr>
                <tr>
                    <td>17:00</td>
                    <td id="Mon_17"></td>
                    <td id="Tue_17"></td>
                    <td id="Wed_17"></td>
                    <td id="Thur_17"></td>
                    <td id="Fri_17"></td>
                </tr>
                <tr>
                    <td>17:30</td>
                    <td id="Mon_17.5"></td>
                    <td id="Tue_17.5"></td>
                    <td id="Wed_17.5"></td>
                    <td id="Thur_17.5"></td>
                    <td id="Fri_17.5"></td>
                </tr>
                <tr>
                    <td>18:00</td>
                    <td id="Mon_18"></td>
                    <td id="Tue_18"></td>
                    <td id="Wed_18"></td>
                    <td id="Thur_18"></td>
                    <td id="Fri_18"></td>
                </tr>
            </table>
        </section>
    </main>
    <footer>
        <img src="{% static 'reservation/footer_logo.png' %}" alt="footer_logo" />
        <span class="contact" style="font-size:x-large; color:inherit ;">
                <a href="https://open.kakao.com/o/srtwxB0d" target="_blank" style="color:white;"><i class="far fa-comment"></i></a>
                <a href="https://www.tmdlab.com/#/w/ko/home" target="_blank" style="color:white;">티엠디랩</a>

        </span>
        <p>티엠디랩 Tel: 02-6216-0080</p>
        <p>만든사람 <span style="font-size: x-small;"><a target="_blank" style="color:white; text-decoration: none;" href="https://github.com/MCprotein">신윤수</a></span></p>
        <p class="copyright">Copyright(c) SYS. All rights reserved.</p>
    </footer>
    <script src="{% static 'reservation/main.js' %}"></script>
    <script>
        $(function() {
            //input을 datepicker로 선언
            $("#datepicker").datepicker({
                dateFormat: 'yy-mm-dd ' //Input Display Format 변경
                ,showOtherMonths: true //빈 공간에 현재월의 앞뒤월의 날짜를 표시
                ,showMonthAfterYear:false //년도 먼저 나오고, 뒤에 월 표시
                ,changeYear: true //콤보박스에서 년 선택 가능
                ,changeMonth: true //콤보박스에서 월 선택 가능
                ,showOn: "both" //button:버튼을 표시하고,버튼을 눌러야만 달력 표시 ^ both:버튼을 표시하고,버튼을 누르거나 input을 클릭하면 달력 표시
                ,buttonImage: "http://jqueryui.com/resources/demos/datepicker/images/calendar.gif" //버튼 이미지 경로
                ,buttonImageOnly: true //기본 버튼의 회색 부분을 없애고, 이미지만 보이게 함
                ,buttonText: "선택" //버튼에 마우스 갖다 댔을 때 표시되는 텍스트
                ,yearSuffix: "년" //달력의 년도 부분 뒤에 붙는 텍스트
                ,monthNamesShort: ['1','2','3','4','5','6','7','8','9','10','11','12'] //달력의 월 부분 텍스트
                ,monthNames: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'] //달력의 월 부분 Tooltip 텍스트
                ,dayNamesMin: ['일','월','화','수','목','금','토'] //달력의 요일 부분 텍스트
                ,dayNames: ['일요일','월요일','화요일','수요일','목요일','금요일','토요일'] //달력의 요일 부분 Tooltip 텍스트
                ,minDate: "+{{weekday_mark}}D" //최소 선택일자(-1D:하루전, -1M:한달전, -1Y:일년전)
                ,maxDate: "+{{date_diff}}D" //최대 선택일자(+1D:하루후, -1M:한달후, -1Y:일년후)
            });

            //초기값을 오늘 날짜로 설정
            $('#datepicker').datepicker('setDate', 'today'); //(-1D:하루전, -1M:한달전, -1Y:일년전), (+1D:하루후, -1M:한달후, -1Y:일년후)
        });
    </script>
    <script type="text/javascript">
        // New 페이지 이동
        function goNewHood(){
            location.href="/reservation/new/Hood";
        }
        function goNewChiller(){
            location.href="/reservation/new/Chiller";
        }
        function goNewPress(){
            location.href="/reservation/new/Press";
        }
        function goNewDsc(){
            location.href="/reservation/new/Dsc";
        }
        function goNewGpc(){
            location.href="/reservation/new/Gpc";
        }
        function goNewUtm(){
            location.href="/reservation/new/Utm";
        }
        function goNewCrosslinker(){
            location.href="/reservation/new/Crosslinker";
        }

        // finish 시간 세팅
        function finishSet(){
            $('#equip_finish_time').empty();
            var start_time = $('#equip_start_time').val(); // 시작시간 가져오기
            var hour = Math.floor(start_time); // 시 가져오기
            var min = start_time-hour // 분 가져오기
            for(var cnt = 0; cnt<19; cnt++){
                // 시간 늘리기
                min = min+0.5;
                if(min == 1){
                    hour+=1;
                    min=0;
                }

                // 탈출 조건
                if(hour+min == 19){
                    break;
                }

                // 출력양식 조절
                if(hour == 9 && min== 0.5){
                    var option = $("<option value="+(hour+min)+">0"+hour+":"+ "30</option>");
                }
                else if(min==0){
                    var option = $("<option value="+(hour+min)+">"+hour+":"+ min + "0</option>");
                }
                else{
                    var option = $("<option value="+(hour+min)+">"+hour+":" +"30</option>");
                }
                $('#equip_finish_time').append(option);


            }

        }
    </script>
    <!-- 색칠하기 Script -->
    <script type="text/javascript">
        $(function() {
            var day_list = {{day_list}};
            var day_name = ['Mon', 'Tue', 'Wed', 'Thur', 'Fri'];
            var kor_day_name = [' 월', ' 화', ' 수', ' 목', ' 금'];
            var author_username = '{{author_username|safe}}';
            // 시작 날짜 세팅
            var day = new Date();
            day.setDate(day.getDate()+{{start_day_diff}}-1);

            // 예약 세팅


            for(var i =0; i<5;i++){
                // 날짜 세팅
                day.setDate(day.getDate()+1);
                var dd = day.getDate();
                var mm = day.getMonth()+1;
                document.getElementById(day_name[i]).innerHTML= mm.toString() + "/"+ dd.toString() + kor_day_name[i];

                for(var j=0; j<day_list[i].length; j++){
                    document.getElementById( day_name[i]+'_'+day_list[i][j] ).innerHTML='{{author_username}}';
                    if( $('#equipment_type').val()=='Hood')
                        document.getElementById( day_name[i]+'_'+day_list[i][j] ).style.backgroundColor='rgba(255, 205, 86)';
                    else if( $('#equipment_type').val()=='Chiller')
                        document.getElementById( day_name[i]+'_'+day_list[i][j]).style.backgroundColor='rgba(54, 162, 235)';
                    else if( $('#equipment_type').val()=='Press')
                        document.getElementById( day_name[i]+'_'+day_list[i][j]).style.backgroundColor='rgba(255, 99, 132)';
                    else if( $('#equipment_type').val()=='Dsc')
                        document.getElementById( day_name[i]+'_'+day_list[i][j]).style.backgroundColor='rgba(110, 227, 86)';
                    else if( $('#equipment_type').val()=='Gpc')
                        document.getElementById( day_name[i]+'_'+day_list[i][j]).style.backgroundColor='rgba(119, 86, 227)';
                    else if( $('#equipment_type').val()=='Utm')
                        document.getElementById( day_name[i]+'_'+day_list[i][j]).style.backgroundColor='rgba(240, 5, 64)';
                    else if( $('#equipment_type').val()=='Crosslinker')
                        document.getElementById( day_name[i]+'_'+day_list[i][j]).style.backgroundColor='rgba(70, 71, 69)';
                }
            }

        });
    </script>

    <!-- Ajax 예약 점검 -->
    <script type="text/javascript">
        $("#equip_check").click(function(){
            var equipment_type = $('#equipment_type').val();
            var equipment_date = $('#datepicker').val();
            var equip_start_time = $('#equip_start_time').val();
            var equip_finish_time= $('#equip_finish_time').val();

            $.ajax({ // ajax로 서버와 통신하겠다.
                type: "POST", // 데이터를 전송하는 방법을 지정
                url: "{% url 'reservation:check' %}", // 통신할 url을 지정
                data: {'equipment_type': equipment_type, 'equipment_date': equipment_date, 'equip_start_time':equip_start_time, 'equip_finish_time':equip_finish_time, 'csrfmiddlewaretoken': '{{ csrf_token }}'}, // 서버로 데이터 전송시 옵션
                dataType: "json", // 서버측에서 전송한 데이터를 어떤 형식의 데이터로서 해석할 것인가를 지정, 없으면 알아서 판단
                // 서버측에서 전송한 Response 데이터 형식 (json)
                // {'likes_count': post.like_count, 'message': message }
                success: function(response){ // 통신 성공시 - 동적으로 좋아요 갯수 변경, 유저 목록 변경
                    // 성공 시
                    if(response.check_error == 0){
                        var result = confirm("예약하시겠습니까?");
                        if(result){
                            $('#new_form').submit(); // 제출
                        }
                    }
                    // 실패
                    else{
                        alert(response.message);
                    }
                },
                error: function(request, status, error){ // 통신 실패시 - 로그인 페이지 리다이렉트
                    alert("입력값을 다시 한번 확인 부탁드립니다");
                },
            });
        })
    </script>
{% endblock %}
{% block style %}
<style>
    #equip_check{
        width: 70px;
        height: 35px;
        bottom: 15vh;
        background: rgba(218,33,39);
        font-size: 1em;
        color: rgb(225,225,225);
        border: none;
        border-radius: 3px;
    }

    #equip_check:hover{
        cursor: pointer;
    }

    main>#reserve_all td{
        color:aliceblue;
        font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    }
</style>
{% endblock %}

